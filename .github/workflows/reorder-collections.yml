name: Reorder Shopify Collections

on:
  workflow_dispatch:      # bot칩n "Run workflow" en Actions
  schedule:
    - cron: "0 7 * * *"   # 07:00 UTC = 1:00 a. m. America/Mexico_City

jobs:
  reorder:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    env:
      SHOPIFY_STORE_DOMAIN: ${{ secrets.SHOPIFY_STORE_DOMAIN }}
      SHOPIFY_ADMIN_TOKEN:  ${{ secrets.SHOPIFY_ADMIN_TOKEN }}
      SHOPIFY_API_VERSION:  ${{ secrets.SHOPIFY_API_VERSION }}  # opcional; script tiene default
      # Controles de ejecuci칩n
      DRY_RUN: "false"                # primero simulaci칩n (no aplica cambios)
      INCLUDE_SMART: "true"          # incluye colecciones autom치ticas
      INCLUDE_MANUAL: "true"         # incluye colecciones manuales
      HANDLE_PREFIX: ""              # opcional: filtra por prefijo de handle

      # EXCLUSIONES
      EXCLUDE_COLLECTION_IDS: "648364163362"
      EXCLUDE_HANDLES: ""

      # Control de costo de consultas
      MAX_PRODUCTS_PER_PAGE: "12"    # reduce si ves costo alto
      MAX_INVENTORY_LEVELS: "1"      # si tienes 1 sola location, pon "1"
      LOCATION_IDS: ""               # opcional: IDs de locations (coma-separadas)
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Show repo files (debug)
        run: |
          pwd
          ls -la
          ls -la scripts || true

      - name: Run reorder script
        run: node scripts/reorder-all-collections.js
